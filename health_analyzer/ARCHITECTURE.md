# LabLens - Architecture Diagrams

## ğŸ“ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER INTERFACE                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Profile  â”‚  â”‚  Scan    â”‚  â”‚  Trend   â”‚  â”‚ Settings â”‚   â”‚
â”‚  â”‚  Screen  â”‚  â”‚  Screen  â”‚  â”‚  Screen  â”‚  â”‚  Screen  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚      VIEW MODELS (State Management)      â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Profile  â”‚  â”‚  Report  â”‚  â”‚  Chart   â”‚  â”‚ Settings â”‚  â”‚
â”‚  â”‚ViewModel â”‚  â”‚ViewModel â”‚  â”‚ViewModel â”‚  â”‚ViewModel â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       â”‚          SERVICES (Business Logic)       â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              DatabaseHelper (SQLite)                 â”‚  â”‚
â”‚  â”‚  â€¢ Profile CRUD    â€¢ Report Storage                  â”‚  â”‚
â”‚  â”‚  â€¢ Trend Queries   â€¢ Parameter Tracking              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚                                           â”‚          â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ GeminiService â”‚  â”‚ LOINCMapper  â”‚  â”‚ DocumentPicker â”‚  â”‚
â”‚  â”‚ â€¢ OCR Extract â”‚  â”‚ â€¢ Normalize  â”‚  â”‚ â€¢ Image/PDF    â”‚  â”‚
â”‚  â”‚ â€¢ AI Process  â”‚  â”‚ â€¢ Map Names  â”‚  â”‚ â€¢ Validation   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA LAYER                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   SQLite    â”‚  â”‚   Gemini    â”‚  â”‚    File     â”‚         â”‚
â”‚  â”‚  Database   â”‚  â”‚   API (AI)  â”‚  â”‚   Storage   â”‚         â”‚
â”‚  â”‚  â€¢ profiles â”‚  â”‚  â€¢ Extract  â”‚  â”‚  â€¢ Images   â”‚         â”‚
â”‚  â”‚  â€¢ reports  â”‚  â”‚  â€¢ Analyze  â”‚  â”‚  â€¢ PDFs     â”‚         â”‚
â”‚  â”‚  â€¢ params   â”‚  â”‚  â€¢ JSON     â”‚  â”‚             â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Data Flow - Scanning a Report

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Action â”‚
â”‚ "Scan Report"â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. User selects Profile & Image/PDF     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. DocumentPickerService validates file â”‚
â”‚    â€¢ Check size (<10MB)                  â”‚
â”‚    â€¢ Check type (jpg/png/pdf)           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. GeminiService.extractBloodReportData â”‚
â”‚    a. Read file bytes                    â”‚
â”‚    b. Send to Gemini API with prompt    â”‚
â”‚    c. Receive JSON response              â”‚
â”‚    d. Parse and validate                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. LOINCMapper.normalize parameters      â”‚
â”‚    â€¢ "RBC Count" â†’ "rbc_count"          â”‚
â”‚    â€¢ "WBC" â†’ "wbc_count"                â”‚
â”‚    â€¢ Fuzzy match unknown params         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. DatabaseHelper.saveBloodReport       â”‚
â”‚    [Transaction Start]                   â”‚
â”‚    a. INSERT into reports table         â”‚
â”‚    b. INSERT each parameter             â”‚
â”‚    [Transaction Commit]                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. UI Updates                            â”‚
â”‚    â€¢ Show success message               â”‚
â”‚    â€¢ Navigate to profile dashboard      â”‚
â”‚    â€¢ Display latest values              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      profiles       â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id (PK)           â”‚
â”‚ â€¢ name              â”‚
â”‚ â€¢ date_of_birth     â”‚
â”‚ â€¢ gender            â”‚
â”‚ â€¢ photo_path        â”‚
â”‚ â€¢ created_at        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1
           â”‚ owns
           â”‚ many
           â–¼ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      reports        â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id (PK)           â”‚
â”‚ â€¢ profile_id (FK) â—„â”€â”˜
â”‚ â€¢ test_date         â”‚
â”‚ â€¢ lab_name          â”‚
â”‚ â€¢ report_image_path â”‚
â”‚ â€¢ created_at        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1
           â”‚ has
           â”‚ many
           â–¼ N
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   blood_parameters      â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ id (PK)               â”‚
â”‚ â€¢ report_id (FK) â—„â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ parameter_name        â”‚  (normalized: "rbc_count")
â”‚ â€¢ parameter_value       â”‚  (numeric: 5.2)
â”‚ â€¢ unit                  â”‚  ("million cells/Î¼L")
â”‚ â€¢ reference_range_min   â”‚  (4.5)
â”‚ â€¢ reference_range_max   â”‚  (5.9)
â”‚ â€¢ raw_parameter_name    â”‚  (original: "RBC Count")
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Indexes:
â€¢ idx_reports_profile (profile_id)
â€¢ idx_reports_date (test_date)
â€¢ idx_parameters_name (parameter_name)
```

## ğŸ”€ Parameter Normalization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raw Data from Blood Report                 â”‚
â”‚  "RBC Count: 5.2 million cells/Î¼L"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 1: Gemini AI Normalization           â”‚
â”‚ Prompt instructs: Convert to "rbc_count"   â”‚
â”‚ Output: {                                   â”‚
â”‚   "rbc_count": {                            â”‚
â”‚     "value": 5.2,                           â”‚
â”‚     "unit": "million cells/Î¼L",            â”‚
â”‚     "raw_name": "RBC Count"                â”‚
â”‚   }                                         â”‚
â”‚ }                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 2: LOINC Mapper Verification         â”‚
â”‚ Check mapping table:                        â”‚
â”‚ â€¢ "rbc count" â†’ "rbc_count" âœ“              â”‚
â”‚ â€¢ "red blood cells" â†’ "rbc_count" âœ“        â”‚
â”‚ â€¢ "erythrocytes" â†’ "rbc_count" âœ“           â”‚
â”‚ Result: Confirmed as "rbc_count"           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LAYER 3: Fuzzy Matching (if needed)        â”‚
â”‚ For unknown variations:                     â”‚
â”‚ â€¢ "RBC-Count" â†’ 95% match â†’ "rbc_count"    â”‚
â”‚ â€¢ "RBC#" â†’ 88% match â†’ "rbc_count"         â”‚
â”‚ Threshold: 85% similarity                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FINAL: Standardized Parameter              â”‚
â”‚ Database Storage:                           â”‚
â”‚ â€¢ parameter_name: "rbc_count"              â”‚
â”‚ â€¢ parameter_value: 5.2                     â”‚
â”‚ â€¢ unit: "million cells/Î¼L"                 â”‚
â”‚ â€¢ raw_parameter_name: "RBC Count"          â”‚
â”‚                                             â”‚
â”‚ âœ… Consistent across all reports!          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ˆ Trend Visualization Data Flow

```
User selects: Profile="Father", Parameter="rbc_count"
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DatabaseHelper.getParameterTrend()         â”‚
â”‚ Query:                                      â”‚
â”‚   SELECT test_date, parameter_value        â”‚
â”‚   FROM blood_parameters bp                 â”‚
â”‚   JOIN reports r ON bp.report_id = r.id   â”‚
â”‚   WHERE r.profile_id = ? AND               â”‚
â”‚         bp.parameter_name = ?              â”‚
â”‚   ORDER BY test_date ASC                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Retrieved:                             â”‚
â”‚ [                                           â”‚
â”‚   {date: "2024-01-15", value: 5.1},       â”‚
â”‚   {date: "2024-04-20", value: 5.3},       â”‚
â”‚   {date: "2024-07-10", value: 5.0},       â”‚
â”‚   {date: "2024-10-19", value: 5.2}        â”‚
â”‚ ]                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FL Chart LineChart Widget                   â”‚
â”‚                                             â”‚
â”‚  RBC Count Trend                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â”‚ 5.9 â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„ (max)      â”‚   â”‚
â”‚  â”‚     â•±â•²                              â”‚   â”‚
â”‚  â”‚ 5.2    â•²â•±â•²                          â”‚   â”‚
â”‚  â”‚           â•²                         â”‚   â”‚
â”‚  â”‚ 4.5 â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„â”„ (min)      â”‚   â”‚
â”‚  â”‚                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚    Jan   Apr   Jul   Oct                   â”‚
â”‚    2024  2024  2024  2024                  â”‚
â”‚                                             â”‚
â”‚  Reference Range: 4.5 - 5.9                â”‚
â”‚  Current Value: 5.2 (Normal âœ“)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           USER DEVICE (Local)               â”‚
â”‚                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      App Sandbox                  â”‚     â”‚
â”‚  â”‚                                   â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚ FlutterSecureStorage    â”‚     â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Gemini API Key        â”‚     â”‚     â”‚
â”‚  â”‚  â”‚   (Encrypted)           â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â”‚                                   â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚ SQLite Database         â”‚     â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Profiles              â”‚     â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Reports               â”‚     â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Parameters            â”‚     â”‚     â”‚
â”‚  â”‚  â”‚   (Local Only)          â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â”‚                                   â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚     â”‚
â”‚  â”‚  â”‚ File Storage            â”‚     â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Report Images         â”‚     â”‚     â”‚
â”‚  â”‚  â”‚ â€¢ Report PDFs           â”‚     â”‚     â”‚
â”‚  â”‚  â”‚   (Private Directory)   â”‚     â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                             â”‚
â”‚  Only during scan:                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  HTTPS Connection   â”‚                   â”‚
â”‚  â”‚  to Gemini API      â”‚                   â”‚
â”‚  â”‚  â€¢ Image bytes      â”‚                   â”‚
â”‚  â”‚  â€¢ Prompt text      â”‚                   â”‚
â”‚  â”‚  â†“                  â”‚                   â”‚
â”‚  â”‚  â€¢ JSON response    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                             â”‚
â”‚  No other external connections             â”‚
â”‚  No cloud storage                           â”‚
â”‚  No analytics/telemetry                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¨ UI Component Hierarchy

```
MaterialApp
â””â”€â”€ HomeScreen
    â”œâ”€â”€ AppBar (Title: "LabLens")
    â”œâ”€â”€ Body
    â”‚   â””â”€â”€ ProfileList
    â”‚       â”œâ”€â”€ ProfileCard (Father)
    â”‚       â”‚   â”œâ”€â”€ Avatar
    â”‚       â”‚   â”œâ”€â”€ Name
    â”‚       â”‚   â”œâ”€â”€ ReportCount
    â”‚       â”‚   â””â”€â”€ AbnormalIndicator
    â”‚       â”œâ”€â”€ ProfileCard (Mother)
    â”‚       â””â”€â”€ ProfileCard (...)
    â””â”€â”€ FloatingActionButton (Add Profile)

    On Tap ProfileCard â†’ ProfileDashboard
    â”œâ”€â”€ AppBar (Profile Name)
    â”œâ”€â”€ Body
    â”‚   â”œâ”€â”€ LatestReportCard
    â”‚   â”‚   â”œâ”€â”€ Date
    â”‚   â”‚   â”œâ”€â”€ LabName
    â”‚   â”‚   â””â”€â”€ ParameterSummary
    â”‚   â”œâ”€â”€ ParameterList
    â”‚   â”‚   â”œâ”€â”€ ParameterTile (RBC)
    â”‚   â”‚   â”œâ”€â”€ ParameterTile (WBC)
    â”‚   â”‚   â””â”€â”€ ParameterTile (...)
    â”‚   â””â”€â”€ ReportHistoryList
    â””â”€â”€ FloatingActionButton (Scan Report)

        On Tap Scan â†’ ScanReportScreen
        â”œâ”€â”€ AppBar ("Scan Blood Report")
        â”œâ”€â”€ Body
        â”‚   â”œâ”€â”€ ImagePreview
        â”‚   â”œâ”€â”€ PickerButtons
        â”‚   â”‚   â”œâ”€â”€ TakePhoto
        â”‚   â”‚   â”œâ”€â”€ ChooseGallery
        â”‚   â”‚   â””â”€â”€ SelectPDF
        â”‚   â””â”€â”€ ExtractButton
        â””â”€â”€ OnExtract â†’ ReviewDataScreen
            â”œâ”€â”€ AppBar ("Review Data")
            â”œâ”€â”€ Body
            â”‚   â””â”€â”€ ExtractedParameterList
            â”‚       â”œâ”€â”€ EditableParameterTile
            â”‚       â””â”€â”€ EditableParameterTile
            â””â”€â”€ SaveButton

        On Tap ParameterTile â†’ TrendChartScreen
        â”œâ”€â”€ AppBar (Parameter Name)
        â”œâ”€â”€ Body
        â”‚   â”œâ”€â”€ TimeRangePicker
        â”‚   â”œâ”€â”€ LineChart (FL Chart)
        â”‚   â”‚   â”œâ”€â”€ DataPoints
        â”‚   â”‚   â”œâ”€â”€ TrendLine
        â”‚   â”‚   â””â”€â”€ ReferenceRangeLines
        â”‚   â””â”€â”€ StatsSummary
        â”‚       â”œâ”€â”€ LatestValue
        â”‚       â”œâ”€â”€ AverageValue
        â”‚       â””â”€â”€ TrendDirection
        â””â”€â”€ ExportButton
```

## ğŸ”„ State Management Flow (Provider)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Widget Tree                     â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ ChangeNotifierProvider        â”‚     â”‚
â”‚  â”‚ <ProfileViewModel>            â”‚     â”‚
â”‚  â”‚   â”‚                           â”‚     â”‚
â”‚  â”‚   â”œâ”€> ProfileListScreen       â”‚     â”‚
â”‚  â”‚   â”‚    â””â”€> Consumer<Profile   â”‚     â”‚
â”‚  â”‚   â”‚         ViewModel>        â”‚     â”‚
â”‚  â”‚   â”‚         â€¢ _profiles       â”‚     â”‚
â”‚  â”‚   â”‚         â€¢ _isLoading      â”‚     â”‚
â”‚  â”‚   â”‚                           â”‚     â”‚
â”‚  â”‚   â””â”€> ProfileDashboard        â”‚     â”‚
â”‚  â”‚        â””â”€> Consumer<Profile   â”‚     â”‚
â”‚  â”‚             ViewModel>        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                         â”‚
â”‚  User Action: "Delete Profile"         â”‚
â”‚         â”‚                               â”‚
â”‚         â–¼                               â”‚
â”‚  ProfileViewModel.deleteProfile(id)    â”‚
â”‚         â”‚                               â”‚
â”‚         â”œâ”€> DatabaseHelper.delete()    â”‚
â”‚         â”‚                               â”‚
â”‚         â””â”€> notifyListeners()          â”‚
â”‚                    â”‚                    â”‚
â”‚                    â–¼                    â”‚
â”‚         All Consumers Rebuild          â”‚
â”‚         â€¢ ProfileListScreen updates    â”‚
â”‚         â€¢ ProfileDashboard closes      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

These diagrams should help visualize:
1. Overall system architecture
2. Data flow during scanning
3. Database relationships
4. Parameter normalization process
5. Trend visualization
6. Security model
7. UI hierarchy
8. State management

**Use these as reference when implementing the UI!** ğŸ¨
